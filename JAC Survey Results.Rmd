---
title: "Aquatic Survey Results"
author: "K. Meyer, K. Bosley"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# General notes - choose color-blind friendly palette, inlcude number of response stats for each question

# tabulate the number of people by geo area relative to census data - how far off the mark?

##Tables and Figures to Include:

# 1.) Summary of responses/what's presented: Include table w/residency status. Total # submissions (include completes and partials), removed non-resident/visitor (include #) surveys for this purpose 
### 2.) Make histogram of duplicate IP's, state the ways we limited the survey responses (one per device and CAPTCHA) 

# 3.) In which area do you live Q
          # - re-do as bar plot w/ table
          # - include table of residents by location and add column with 2020 census data by location
          # - reassign 'other' category (delete non-Jeffco, keep unassigned as 'other')
# 4.) What is your age?
        # - re-do as bar plot (percentage - scale to 100)
        # - table of column sums across age groups, county-wide - include data on age distribution from census data
        # require some manual review/edits - adjust non-numeric entries
# 5.) how important is it to you to have an aquatic facility?
        # - barplot (percentages) w/table (numbers and percentages)
# 6.) swimming ability question
      # - sum across each age group and swimming ability category
      # - create bar chart w/ percentages within each age category
      # - include national data on swimming ability?
# 7.) have you used an aquatic facility in last 2 years?
      # - keep as pie chart
# 8.) which ones did you use?
      # - ordered bar chart (high to low) as percentages
      # - include list of the 'other'
# 9.) how often do you use an aquatic facility?
      # - keep as pie chart w/custom color palette and percentages on chart
# 10.) aquatic amenities
      # - keep as bar chart, reverse order overall
      # - produce age-based figures as well, may not use in presentation
      # - select top 5 per age group
      # - work on a way to bin household ages (mean household age) - if we have time??
# 11.) Non aquatic - exactly the same as above
# 12.) How much more would you use an aquatic facility, if amenities?
      # include pie chart 
      # also include chart with comparison to current useage (bar chart with two colors to show before and after)
# 13.) non-aquatic amenities
      # include pie chart
      # include before and after chart as well?
      # what the survey does and doesn't show here
# 14.) tax Q
      # include as pie-chart w/percentages (raw, unweighted)
      # bar chart by geographic area 
      # bar chart by person responding to represent voting status?
      # weighted pie-chart overall??

 are there other categories that matter and/or other ways to weight the data?


```{r}
# load libraries
library(dplyr)
library(gt)
library(ggplot2)
library(here)
library(viridis)
library(webshot)
```

## Load and filter data for analysis

```{r}
survey.dat <- read.csv(here("data",'JAC_Survey_3.2.25.csv'))

# replace column names
colnames.og <- colnames(survey.dat) 
colnames.new <- c("Response.ID","IP.address","Response.status","Survey.URL","Start.time","Completion.time","Time.taken",
                          "Collector","JeffCo.resident","City.area","Age","Under7","7_12","13_18","19_34","35_54","55-64","65_74","75_older","RateNewPoolImportance",
                          "Under7_Non.swimmer","Under7_Beginner","Under7_Intermediate","Under7_Advanced",
                          "7_12_Non.swimmer","7_12_Beginner","7_12_Intermediate","7_12_Advanced",
                          "13_18_Non.swimmer","13_18_Beginner","13_18_Intermediate","13_18_Advanced",
                          "19_34_Non.swimmer","19_34_Beginner","19_34_Intermediate","19_34_Advanced",
                          "35_54_Non.swimmer","35_54_Beginner","35_54_Intermediate","35_54_Advanced",
                          "55-64_Non.swimmer","55-64_Beginner","55-64_Intermediate","55-64_Advanced",
                          "65_74_Non.swimmer","65_74_Beginner","65_74_Intermediate","65_74_Advanced",
                          "75_older_Non.swimmer","75_older_Beginner","75_older_Intermediate","75_older_Advanced","UsedAquaticsPast2Years",
                          "WhichAquaticFacilities","FacilityUsageRate","AquaAmenities_LapSwimming","AquaAmenities_OpenSwim","AquaAmenities_YouthLessons",
                          "AquaAmenities_AdultLessons","AquaAmenities_CompetitiveSwim","AquaAmenities_LifeguardTrain","AquaAmenities_Aerobics",
                          "AquaAmenities_SyncroSwim","AquaAmenities_SportsLeagues","AquaAmenities_SafetyTrain","AquaAmenities_Therapeutic",
                          "AquaAmenities_PartyRental","AquaAmenities_ParentChild","AquaAmenities_Sauna","AquaAmenities_HotTub","AquaAmenities_PublicShower",
                          "AquaAmenities_OutdoorPool","AquaAmenities_SplashPark","AquaAmenities_UsageRate","RecAmenities_AfterschoolCamps",
                          "RecAmenities_Preschool","RecAmenities_Childcare","RecAmenities_Playgroups","RecAmenities_FitnessClass","RecAmenities_PhysTherapy",
                          "RecAmenities_EventSpace","RecAmenities_WellnessClass","RecAmenities_Kitchen","RecAmenities_Cafe","RecAmenities_Gym",
                          "RecAmenities_OutPickleball","RecAmenities_InPickleball","RecAmenities_RockClimb","RecAmenities_TeenFit","RecAmenities_TeenCenter",
                          "RecAmenities_UsageRate","TaxSupport","Comments")

### Set Column Names and Remove Non-resident/tourist surveys
ResidentSurvey.dat <- cbind(survey.dat[,1:92],survey.dat[,122])
colnames(ResidentSurvey.dat) <- colnames.new

ResidentSurvey.dat <- survey.dat %>%
                        {cbind(.[, 1:92], .[, 122])} %>%
                        filter(Do.you.live.in.Jefferson.County.!="No, I am visiting")%>%
                        setNames(colnames.new)

# drop columns we aren't using
ResidentSurvey.dat <- ResidentSurvey.dat[,10:92] 

```

## Question 3. In which city or area do you live?

```{r}
# creates figure

# filter out 'other' category temporarily; need to go reclassify as possible
ResidentSurvey.dat <- ResidentSurvey.dat[!grepl("^Other \\(Please specify\\)", ResidentSurvey.dat$City.area), ]

# drop the blank entries
ResidentSurvey.dat <- filter(ResidentSurvey.dat, City.area != "")

# Count the occurrences of each unique 'City.area'
city_area_counts <- table(ResidentSurvey.dat$City.area)

# Convert the table to a data frame for ggplot
city_area_df <- as.data.frame(city_area_counts)
colnames(city_area_df) <- c("City.area", "Count")

# Create a bar plot with a colorblind-friendly palette
plot <- ggplot(city_area_df, aes(x = City.area, y = Count, fill = City.area)) +
  geom_bar(stat = "identity") +
  scale_color_viridis(discrete = TRUE) +  # Use a colorblind-friendly palette
  labs(title = "Number of Records for Each City Area",
       x = "City/Area",
       y = "Number of Responses") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis labels

print(plot)

# save figure with fixed dimensions to standardize w/others
ggsave(here("figures","city_area_plot.png"), plot = plot, width = 8, height = 6, units = "in", dpi = 300)


```

```{r}
# produces table of results

# Convert the table to a data frame for better handling
data <- as.data.frame(city_area_counts)
colnames(data) <- c("City.area", "Num.responses")

# create a table using gt package
# Create a styled table with the required bold and grey lines
table_gt <- data %>%
  gt() %>%
  cols_label(
    City.area = "City/Area",
    Num.responses = "Number of Responses"
  ) %>%
  # Left-justify the City/Area column data
  tab_style(
    style = cell_text(align = "left"),
    locations = cells_body(columns = "City.area")
  ) %>%
  # Left-justify the "City/Area" column name
  tab_style(
    style = cell_text(align = "left"),
    locations = cells_column_labels(columns = "City.area")
  ) %>%
  # Make column headers bold
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_column_labels(columns = c("City.area", "Num.responses"))
  ) %>%
  # Bold the line above the column headers (top of the table)
  tab_style(
    style = cell_borders(sides = "top", weight = 2),
    locations = cells_column_labels(columns = c("City.area", "Num.responses"))
  ) %>%
  # Bold the line below the column headers (under the header row)
  tab_style(
    style = cell_borders(sides = "bottom", weight = 2),
    locations = cells_column_labels(columns = c("City.area", "Num.responses"))
  ) %>%
  # Bold the bottom line of the table (under the last row of data)
  tab_style(
    style = cell_borders(sides = "bottom", weight = 2),
    locations = cells_body(rows = nrow(city_area_df), columns = c("City.area", "Num.responses"))
  ) 

# Save the table as an HTML file first
gtsave(table_gt, here::here("tables", "City_Area_Table.html"))

# Convert the HTML table to a PNG file
webshot(here::here("tables", "City_Area_Table.html"), here::here("tables", "City_Area_Table.png"), vwidth = 800, vheight = 600)
```

